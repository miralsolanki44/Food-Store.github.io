define(['jquery','Magento_Customer/js/model/authentication-popup','Magento_Customer/js/customer-data','Snowdog_CartSharing/js/checkout-redirect','Magento_Ui/js/modal/confirm'],function($,authenticationPopup,customerData,checkoutRedirect,confirm){'use strict';return function(widget){$.widget('mage.sidebar',widget,{isUpdateCart:false,_initContent:function(){var self=this,events={};this.element.decorate('list',this.options.isRecursive);events['click '+this.options.button.close]=function(event){event.stopPropagation();$(self.options.targetElement).dropdownDialog('close');};events['click '+this.options.button.checkout]=$.proxy(function(){var cart=customerData.get('cart'),customer=customerData.get('customer'),element=$(this.options.button.checkout),redirectData;if(!customer().firstname&&cart().isGuestCheckoutAllowed===false){$.cookie('login_redirect',this.options.url.checkout);if(this.options.url.isRedirectRequired){element.prop('disabled',true);location.href=this.options.url.loginUrl;}else{authenticationPopup.showModal();}
return false;}
element.prop('disabled',true);if(redirectData=checkoutRedirect.getRedirectData()){checkoutRedirect.postData(redirectData);return true;}
location.href=this.options.url.checkout;},this);events['click '+this.options.button.remove]=function(event){event.stopPropagation();confirm({content:self.options.confirmMessage,actions:{confirm:function(){self._removeItem($(event.currentTarget));},always:function(e){e.stopImmediatePropagation();}}});};events['keyup '+this.options.item.qty]=function(event){var code=(event.keyCode?event.keyCode:event.which);if(code!==9&&code!==16){self._showItemButton($(event.target));}};events['change '+this.options.item.qty]=function(event){self._showItemButton($(event.target));};events['click '+this.options.item.button]=function(event){event.stopPropagation();self._updateItemQty($(event.currentTarget));};events['focusout '+this.options.item.qty]=function(event){self._validateQty($(event.currentTarget));};this._on(this.element,events);this._calcHeight();this._isOverflowed();},_isOverflowed:function(){var list=$(this.options.minicart.list),cssOverflowClass='overflowed';if(this.scrollHeight>list.innerHeight()){list.parent().addClass(cssOverflowClass);}else{list.parent().removeClass(cssOverflowClass);}
if(window.is_add_to_cart){$('button[data-modal-trigger="modal-minicart"]').click();if(!this.isUpdateCart){var modalFocus=false;$('#modal-minicart .modal__container').hover(function(){modalFocus=true;});setTimeout(function(){if(!modalFocus)
$('#modal-minicart button.modal__close-button').trigger('click');},3000);}
window.is_add_to_cart=false;}},_updateItemQtyAfter:function(elem){var productData=this._getProductById(Number(elem.data('cart-item')));if(!_.isUndefined(productData)){$(document).trigger('ajax:updateCartItemQty');if(window.location.href===this.shoppingCartUrl){window.location.reload(false);}}
this._hideItemButton(elem);this.isUpdateCart=true;},_removeItemAfter:function(elem){var productData=this._getProductById(Number(elem.data('cart-item')));if(!_.isUndefined(productData)){$(document).trigger('ajax:removeFromCart',{productIds:[productData['product_id']]});if(window.location.href.indexOf(this.shoppingCartUrl)===0){window.location.reload();}}
this.isUpdateCart=true;},});return $.mage.sidebar;}});