define(["jquery","mage/translate",'Magento_Catalog/js/product/view/product-ids-resolver'],function($,$t,idsResolver){"use strict";return function(parentWidget){$.widget("mage.catalogAddToCart",parentWidget,{ajaxSubmit:function(form){var self=this,productIds=idsResolver(form),formData;window.is_add_to_cart=false;$(self.options.minicartSelector).trigger('contentLoading');self.disableAddToCartButton(form);formData=new FormData(form[0]);$.ajax({url:form.attr('action'),data:formData,type:'post',dataType:'json',cache:false,contentType:false,processData:false,beforeSend:function(){if(self.isLoaderEnabled()){$('body').trigger(self.options.processStart);}},success:function(res){var eventData,parameters;$(document).trigger('ajax:addToCart',{'sku':form.data().productSku,'productIds':productIds,'form':form,'response':res});if(self.isLoaderEnabled()){$('body').trigger(self.options.processStop);}
window.is_add_to_cart=true;if(res.backUrl){eventData={'form':form,'redirectParameters':[]};$('body').trigger('catalogCategoryAddToCartRedirect',eventData);if(eventData.redirectParameters.length>0&&window.location.href.split(/[?#]/)[0]===res.backUrl){parameters=res.backUrl.split('#');parameters.push(eventData.redirectParameters.join('&'));res.backUrl=parameters.join('#');}
self._redirect(res.backUrl);return;}
if(res.messages){$(self.options.messagesSelector).html(res.messages);}
if(res.minicart){$(self.options.minicartSelector).replaceWith(res.minicart);$(self.options.minicartSelector).trigger('contentUpdated');}
if(res.product&&res.product.statusText){$(self.options.productStatusSelector).removeClass('available').addClass('unavailable').find('span').html(res.product.statusText);}
self.enableAddToCartButton(form);},error:function(res){$(document).trigger('ajax:addToCart:error',{'sku':form.data().productSku,'productIds':productIds,'form':form,'response':res});},complete:function(res){if(res.state()==='rejected'){location.reload();}}});},disableAddToCartButton:function(form){var addToCartButtonTextWhileAdding=this.options.addToCartButtonTextWhileAdding||$t("Adding..."),addToCartButton=$(form).find(this.options.addToCartButtonSelector);addToCartButton.addClass(this.options.addToCartButtonDisabledClass);addToCartButton.find("span").text(addToCartButtonTextWhileAdding);addToCartButton.attr("title",addToCartButtonTextWhileAdding);addToCartButton.attr("disabled",true);},enableAddToCartButton:function(form){var addToCartButtonTextAdded=this.options.addToCartButtonTextAdded||$t("Added"),self=this,addToCartButton=$(form).find(this.options.addToCartButtonSelector);addToCartButton.find("span").text(addToCartButtonTextAdded);addToCartButton.attr("title",addToCartButtonTextAdded);setTimeout(function(){var addToCartButtonTextDefault=self.options.addToCartButtonTextDefault||$t("Add to Cart");addToCartButton.removeClass(self.options.addToCartButtonDisabledClass);addToCartButton.attr("disabled",false);addToCartButton.find("span").text(addToCartButtonTextDefault);addToCartButton.attr("title",addToCartButtonTextDefault);},1000);}});return $.mage.catalogAddToCart;};});