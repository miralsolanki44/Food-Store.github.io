define(['jquery','ko','underscore','uiComponent','Forix_Widget/js/action/yotpo/load-reviews','mage/translate','mage/template','text!Forix_Widget/template/yotpo/item.html','jquery/validate','mage/validation'],function($,ko,_,Component,loadReviewsAction,$t,mageTemplate,itemTemplate){'use strict';var scrollProvider;scrollProvider={initialize:function(options){this.options=options;this.element=document.getElementsByClassName(this.options.elementSelector)[0];this.bindEvents();},bindEvents:function(){var self=this,scrollHandler;scrollHandler=function(){if(self.isScrolledIntoView(self.element)){self.options.callback();$(document).unbind('scroll',scrollHandler);}};$(document).scroll(scrollHandler);scrollHandler();},isScrolledIntoView:function(element){var elementTop=element.getBoundingClientRect().top,elementBottom=element.getBoundingClientRect().bottom;return(elementTop>=0)&&(elementBottom<=window.innerHeight);}};return Component.extend({defaults:{template:'Forix_Widget/yotpo/reviews',defaultConfig:null,viewContainerSelector:'yopto-reviews-container',gridElementSelector:'.yopto-reviews-container .reviews-grid'},data:ko.observable(null),isLoaded:ko.observable(false),initObservable:function(){this._super();this.itemTmpl=mageTemplate(itemTemplate);return this;},initEvents:function(){this.gridElement=$(this.gridElementSelector);scrollProvider.initialize({elementSelector:this.viewContainerSelector,callback:this.loadReviews.bind(this)});},loadReviews:function(){var self=this;if(self.isLoaded()){return;}
self.isRequestComplete=$.Deferred();loadReviewsAction(self.isRequestComplete,self.defaultConfig.sku);$.when(self.isRequestComplete).done(function(reviews){self.renderGridItems(reviews,self);self.reviewSlider();self.windowResize();}).always(function(){self.isLoaded(true);});},renderGridItems:function(reviews,self){_.each(reviews,function(data){self.gridElement.append($.proxy(function(){var tmpl;tmpl=this.itemTmpl({data:data});return $(tmpl);},self));})},reviewSlider:function(){var wrapper=$(".reviews-grid");if($(window).width()<767){if($(wrapper).length){wrapper.slick({slidesToShow:1,slidesToScroll:1,arrows:false,centerMode:true,centerPadding:'60px',responsive:[{breakpoint:375,settings:{centerPadding:'60px'}},{breakpoint:0,settings:{centerPadding:'30px'}}]});}}else{if($(".reviews-grid.slick-initialized").length){wrapper.slick('unslick');}}},windowResize:function(){var self=this;$(window).resize(function(){self.reviewSlider();});}});});